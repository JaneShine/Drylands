2021年我对斗地主这个卡牌游戏产生了~~浓厚的~~兴趣（欢迎在我的个人视频号主页观看斗地主精彩实况）。但是我不想再研究斗地主了，所以将2021年斗地主的关键思考进行总结，写一个喜闻乐见的斗地主推断脚本。由于我们的主题自始自终都是**量化**，本文档会结合资本市场量化术语与各位一起终结这个游戏。阅读本文档，从此成为朋友圈的斗地主冠军。

#### 游戏简述
  * 游戏形式：卡牌（全集定义）
  * 游戏人数：3（推断的最大迭代）
  * 卡牌组合：单牌、对子、三不带、三带一、三带一对、顺子、连对、飞机、炸弹、王炸（大小比较）
  * 卡牌花色：与游戏无关，但可以提供信息

 ```python
 import numpy as np
 
 num_universe = [3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15] * 4
 joker = [42, 43]
 universe = num_universe + joker
 universe = np.array(num_universe + joker)
 np.random.shuffle(universe)
 ```
 
| 3 | 4 | 5 | 6 | 7 | 8 | 9 | 10 | J  | Q  | K  | A  | 2  | BlackJoker | RedJoker |
|---|---|---|---|---|---|---|----|----|----|----|----|----|------------|----------|
| 3 | 4 | 5 | 6 | 7 | 8 | 9 | 10 | 11 | 12 | 13 | 14 | 15 | 42         | 43       |

#### 牌型推断
  * 视野推断，我们称之为斗地主的截面推断——Cross Section，简单来说就是：
    *  自己四张全有的牌，其他两家没有此牌；
    *  自己只有一张的牌，在其他两家至少是对子以上的牌；
    *  自己一张都没有的牌，警惕*炸弹*终结逃牌。
  * 牌流推断，我们称之为斗地主的时序推断——Time Series：
    *  判断已经出穷尽的牌，迭代记录场上可能的最大牌型；
    *  判断上下游玩家出牌的历史牌流，结合截面信息判断下游逃牌所需的牌型；
    *  从历史牌流打出的位置判断上下游牌整型程度，例如自己手上有一对10，上家曾经打出对10，判断下家没有10，所以不可能有5到9以上的顺子；
    *  地主明牌中的花色牌未被打出，但有其他花色的同数字被打出，判断地主有带有地主明牌数字的顺子。
#### 情景
##### 怎么打地主牌
当不当地主，重点不是牌好不好，而是牌顺不顺。但这不是今天这篇文章讨论的重点。
##### 怎么打农民牌
农民赢法比地主多，除了自己逃牌外，还可以通过传牌给队友获胜，这就与主玩家的实际方位有关系。假设主玩家农民出牌后，轮到另一位农民玩家出牌，传牌、逃牌都比较简单，但假如中间隔着地主，就要再多思考一个了。

#### 牌局还原
```python
# 随机选出三张地主牌
lord_cards_idx = np.random.choice(range(len(universe)), 3, replace=False)
lord_cards = universe[lord_cards_idx]
# 剩下的牌随机等分
universe_modified = np.delete(universe, lord_cards_idx)
combos = np.array_split(universe_modified, 3)
# 对打散的手牌进行排序
combos = np.sort(combos)
```
现在我们随便找个人来当地主（一般有大王，大牌多的更可能叫地主）。
```python
# 找个牌大的当地主
lord_idx = np.where(combos.mean(axis=1)==max(combos.mean(axis=1)))[0][0]
the_lord = combos[lord_idx]
player = [0, 1, 2]
player.remove(lord_idx)
farmers = combos[player]
```

